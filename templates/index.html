<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CNX PBB MASTER v16 | FINAL REVISION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Anuphan:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap');
        body { font-family: 'Anuphan', sans-serif; background-color: #020617; color: #e2e8f0; }
        .mono { font-family: 'JetBrains+Mono', monospace; }
        
        /* Interactive Elements */
        .gate-card.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.15); box-shadow: 0 0 25px rgba(59, 130, 246, 0.3); transform: translateY(-2px); }
        .ac-btn { transition: all 0.2s; border: 1px solid #1e293b; }
        .ac-btn:hover { background: #0f172a; border-color: #3b82f6; }
        .ac-btn.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); box-shadow: inset 0 0 15px rgba(59, 130, 246, 0.1); }
        .ac-disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        
        /* Animations */
        .step-section { max-height: 0; opacity: 0; overflow: hidden; transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .step-section.active { max-height: 3000px; opacity: 1; }
        
        /* Container Styles */
        .glass-panel { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(51, 65, 85, 0.5); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #three-container { 
            width: 100%; height: 450px; 
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            border-radius: 1.5rem; position: relative; overflow: hidden; 
            border: 1px solid #333;
        }
        
        .spec-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .spec-item { background: rgba(30, 41, 59, 0.5); padding: 1rem; border-radius: 0.75rem; border: 1px solid rgba(255,255,255,0.05); }
        .spec-label { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; font-weight: 700; }
        .spec-value { font-family: 'JetBrains+Mono'; font-size: 1.1rem; font-weight: 700; color: #fff; }
    </style>
</head>
<body class="pb-24 bg-slate-950">

    <header class="px-6 py-4 border-b border-slate-800 sticky top-0 z-50 bg-slate-950/90 backdrop-blur-md flex justify-between items-center shadow-lg">
        <div>
            <h1 class="text-lg font-black text-white italic tracking-tighter">CNX PBB MASTER <span class="text-blue-500">v16</span></h1>
            <p class="text-[10px] text-slate-500 font-bold tracking-widest">OPERATOR AUTHORITY SYSTEM</p>
        </div>
        <div class="hidden sm:block text-right">
            <p class="text-[10px] text-emerald-500 font-bold uppercase flex items-center gap-1 justify-end">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Live System
            </p>
        </div>
    </header>

    <main class="p-4 md:p-8 space-y-8 max-w-7xl mx-auto">
        
        <!-- STEP 1: BAY -->
        <section id="step1" class="step-section active">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                <span class="w-8 h-8 rounded-lg bg-blue-600 text-sm flex items-center justify-center font-black">01</span> 
                เลือกหลุมจอด
            </h2>
            <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
                <button onclick="selectBay('3', 2)" id="bay-3" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-slate-400 group-hover:text-white">03</span>
                </button>
                <button onclick="selectBay('4', 4)" id="bay-4" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-emerald-600 group-hover:text-emerald-400">04</span>
                </button>
                <button onclick="selectBay('5', 4)" id="bay-5" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-emerald-600 group-hover:text-emerald-400">05</span>
                </button>
                <button onclick="selectBay('6', 2)" id="bay-6" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-slate-400 group-hover:text-white">06</span>
                </button>
                <button onclick="selectBay('7', 4)" id="bay-7" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-emerald-600 group-hover:text-emerald-400">07</span>
                </button>
                <button onclick="selectBay('8', 2)" id="bay-8" class="gate-card border border-slate-800 p-4 rounded-xl flex flex-col items-center group transition-all">
                    <span class="text-3xl font-black italic text-slate-400 group-hover:text-white">08</span>
                </button>
            </div>
        </section>

        <!-- STEP 2: AIRCRAFT -->
        <section id="step2" class="step-section">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-3 border-t border-slate-800 pt-8">
                <span class="w-8 h-8 rounded-lg bg-blue-600 text-sm flex items-center justify-center font-black">02</span> 
                เลือกแบบเครื่องบิน
            </h2>
            <div id="acGrid" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <!-- JS Injected -->
            </div>
        </section>

        <!-- STEP 3: SPECS & 3D -->
        <section id="step3" class="step-section">
            <h2 class="text-xl font-bold text-emerald-400 italic mb-4 flex items-center gap-3 border-t border-slate-800 pt-8">
                <span class="w-8 h-8 rounded-lg bg-emerald-500 text-black text-sm flex items-center justify-center font-black">03</span> 
                ข้อมูลทางเทคนิคและข้อปฏิบัติ
            </h2>
            
            <div id="resultOutput">
                <!-- Content injected here -->
            </div>
        </section>

    </main>

    <script>
        let currentBay = null;
        let currentAC = null;
        let scene, camera, renderer, aircraftGroup, controls;

        // ข้อมูลหลัก (Master Data)
        const AC_DATA = {
            'A319': { 
                name: 'Airbus A319-100', eng: 2, scale: 0.9,
                specs: { len: '33.84 m', span: '34.10 m', height: '11.76 m', width: '3.95 m', base: '11.04 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'A320-232': { 
                name: 'Airbus A320-232', eng: 2, scale: 1.0,
                specs: { len: '37.57 m', span: '34.10 m', height: '11.76 m', width: '3.95 m', base: '12.64 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'B737-9ER': { 
                name: 'Boeing 737-900ER', eng: 2, scale: 1.15,
                specs: { len: '42.11 m', span: '35.79 m', height: '12.50 m', width: '3.76 m', base: '17.17 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'B737-8': { 
                name: 'Boeing 737-800', eng: 2, scale: 1.05,
                specs: { len: '39.50 m', span: '35.79 m', height: '12.55 m', width: '3.76 m', base: '15.60 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'A321': { 
                name: 'Airbus A321-200', eng: 2, scale: 1.25,
                specs: { len: '44.51 m', span: '34.10 m', height: '11.76 m', width: '3.95 m', base: '16.90 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'A340': { 
                name: 'Airbus A340-300', eng: 4, scale: 1.5,
                specs: { len: '63.69 m', span: '60.30 m', height: '16.91 m', width: '5.64 m', base: '25.60 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            },
            'B737MAX': { 
                name: 'Boeing 737 MAX 8', eng: 2, scale: 1.05,
                specs: { len: '39.52 m', span: '35.92 m', height: '12.30 m', width: '3.76 m', base: '15.60 m' },
                caution: '[รอข้อมูล]', diff: '[รอข้อมูล]', mistake: '[รอข้อมูล]', forbidden: '[รอข้อมูล]', advice: '[รอข้อมูล]' 
            }
        };

        const AC_LIST = Object.keys(AC_DATA);

        function init() {
            const grid = document.getElementById('acGrid');
            grid.innerHTML = AC_LIST.map(id => `
                <button onclick="selectAC('${id}')" id="ac-${id}" data-engines="${AC_DATA[id].eng}" class="ac-btn glass-panel p-4 rounded-xl flex flex-col items-start gap-1 text-left group">
                    <div class="flex justify-between w-full mb-1">
                        <span class="text-[9px] font-bold text-slate-400 bg-slate-900 px-2 py-0.5 rounded border border-slate-700 group-hover:border-blue-500">${AC_DATA[id].eng} ENGINES</span>
                    </div>
                    <span class="text-base font-bold text-white leading-tight group-hover:text-blue-400 transition-colors">${AC_DATA[id].name}</span>
                </button>
            `).join('');
            lucide.createIcons();
        }

        function selectBay(id, maxEngines) {
            currentBay = id;
            document.querySelectorAll('.gate-card').forEach(el => el.classList.remove('active'));
            document.getElementById(`bay-${id}`).classList.add('active');
            
            document.querySelectorAll('.ac-btn').forEach(btn => {
                const eng = parseInt(btn.getAttribute('data-engines'));
                if(eng > maxEngines) btn.classList.add('ac-disabled');
                else btn.classList.remove('ac-disabled');
                btn.classList.remove('active');
            });

            const step2 = document.getElementById('step2');
            step2.classList.add('active');
            document.getElementById('step3').classList.remove('active');
            
            setTimeout(() => step2.scrollIntoView({ behavior: 'smooth' }), 100);
        }

        function selectAC(id) {
            currentAC = id;
            document.querySelectorAll('.ac-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`ac-${id}`).classList.add('active');
            
            updateUI(id);
            
            const step3 = document.getElementById('step3');
            step3.classList.add('active');
            
            setTimeout(() => {
                step3.scrollIntoView({ behavior: 'smooth' });
                initThreeJS(id);
            }, 200);
        }

        function updateUI(id) {
            const data = AC_DATA[id];
            const output = document.getElementById('resultOutput');
            
            output.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <!-- 3D Visualization -->
                    <div class="lg:col-span-2">
                        <div id="three-container">
                            <div class="absolute top-4 left-4 pointer-events-none z-10">
                                <div class="bg-black/50 backdrop-blur-md border border-blue-500/30 p-2 rounded text-[10px] text-blue-400 font-mono">
                                    MODEL: ${data.name}<br>
                                    ANATOMY: CORRECTED<br>
                                    INTERACTION: ENABLED
                                </div>
                            </div>
                            <div class="absolute bottom-4 right-4 pointer-events-none z-10">
                                <div class="flex items-center gap-2 text-[10px] text-slate-500 font-bold uppercase">
                                    <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i> Drag to Rotate
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Specs Panel -->
                    <div class="space-y-4">
                        <div class="glass-panel p-6 rounded-2xl border-l-4 border-blue-500">
                            <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Active Configuration</span>
                            <h3 class="text-2xl font-black text-white mt-1 leading-tight italic">${data.name}</h3>
                        </div>

                        <div class="spec-grid">
                            <div class="spec-item">
                                <p class="spec-label text-blue-400">ความยาว (Length)</p>
                                <p class="spec-value">${data.specs.len}</p>
                            </div>
                            <div class="spec-item">
                                <p class="spec-label text-blue-400">กว้างปีก (Span)</p>
                                <p class="spec-value">${data.specs.span}</p>
                            </div>
                            <div class="spec-item">
                                <p class="spec-label text-slate-400">ความสูงหาง (Height)</p>
                                <p class="spec-value">${data.specs.height}</p>
                            </div>
                            <div class="spec-item">
                                <p class="spec-label text-slate-400">ฐานล้อ (Wheelbase)</p>
                                <p class="spec-value">${data.specs.base}</p>
                            </div>
                            <div class="spec-item col-span-2">
                                <p class="spec-label text-slate-500">ความกว้างลำตัว (Fuselage Width)</p>
                                <p class="spec-value">${data.specs.width}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Operational Procedures (Exact Text Revision) -->
                <div class="glass-panel p-8 rounded-3xl border-t-2 border-emerald-500">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">OPERATIONAL CRITICAL POINTS</h4>
                        <div class="h-px bg-slate-800 flex-1 ml-4"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 1 -->
                        <div class="p-5 rounded-xl border-l-4 border-orange-500 bg-gradient-to-r from-orange-950/20 to-transparent hover:bg-orange-950/30 transition-colors">
                            <h5 class="text-sm font-black text-orange-500 mb-3 flex items-center gap-2">
                                1. จุดที่ต้องระวังมากที่สุด
                            </h5>
                            <p class="text-sm text-slate-300 leading-relaxed pl-1">${data.caution}</p>
                        </div>
                        
                        <!-- 2 -->
                        <div class="p-5 rounded-xl border-l-4 border-blue-500 bg-gradient-to-r from-blue-950/20 to-transparent hover:bg-blue-950/30 transition-colors">
                            <h5 class="text-sm font-black text-blue-400 mb-3 flex items-center gap-2">
                                2. ความแตกต่างจากหลุมอื่น
                            </h5>
                            <p class="text-sm text-slate-300 leading-relaxed pl-1">${data.diff}</p>
                        </div>
                        
                        <!-- 3 -->
                        <div class="p-5 rounded-xl border-l-4 border-yellow-500 bg-gradient-to-r from-yellow-950/20 to-transparent hover:bg-yellow-950/30 transition-colors">
                            <h5 class="text-sm font-black text-yellow-500 mb-3 flex items-center gap-2">
                                3. ข้อผิดพลาดที่พบบ่อย
                            </h5>
                            <p class="text-sm text-slate-300 leading-relaxed pl-1">${data.mistake}</p>
                        </div>
                        
                        <!-- 4 -->
                        <div class="p-5 rounded-xl border-l-4 border-red-500 bg-gradient-to-r from-red-950/20 to-transparent hover:bg-red-950/30 transition-colors">
                            <h5 class="text-sm font-black text-red-500 mb-3 flex items-center gap-2">
                                4. สิ่งที่ไม่ควรทำเด็ดขาด
                            </h5>
                            <p class="text-sm text-slate-300 leading-relaxed pl-1">${data.forbidden}</p>
                        </div>
                        
                        <!-- 5 -->
                        <div class="md:col-span-2 p-6 rounded-xl border-l-4 border-emerald-500 bg-gradient-to-r from-emerald-950/20 to-transparent hover:bg-emerald-950/30 transition-colors">
                            <h5 class="text-sm font-black text-emerald-500 mb-3 flex items-center gap-2">
                                5. คำแนะนำสำหรับพนักงานใหม่
                            </h5>
                            <p class="text-base text-white font-bold italic pl-1">"${data.advice}"</p>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- 3D Engine (Same Corrected Anatomy) ---
        function initThreeJS(acId) {
            const container = document.getElementById('three-container');
            if(!container) return;
            if(renderer) { container.innerHTML = ''; renderer.dispose(); }

            const w = container.clientWidth;
            const h = container.clientHeight;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 10, 60);

            camera = new THREE.PerspectiveCamera(40, w/h, 0.1, 100);
            camera.position.set(12, 8, 12);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(w, h);
            container.appendChild(renderer.domElement);

            if(typeof THREE.OrbitControls !== 'undefined') {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.autoRotate = true;
                controls.autoRotateSpeed = 1.0;
                controls.enableZoom = false;
            }

            aircraftGroup = new THREE.Group();
            scene.add(aircraftGroup);

            const wireMat = new THREE.LineBasicMaterial({ color: 0x3b82f6, transparent: true, opacity: 0.4 });
            const solidMat = new THREE.MeshBasicMaterial({ color: 0x000000 });

            // --- FUSELAGE (+X is Nose) ---
            const fusePoints = [];
            fusePoints.push(new THREE.Vector2(0.15, -5.5)); // Tail tip
            fusePoints.push(new THREE.Vector2(0.65, -3.5));
            fusePoints.push(new THREE.Vector2(0.65, 3.5));
            for(let i=0; i<=6; i++) {
                fusePoints.push(new THREE.Vector2(0.65 * Math.cos(i*0.25), 3.5 + i*0.4)); // Nose
            }
            const fuseGeom = new THREE.LatheGeometry(fusePoints, 16);
            const fuseMesh = new THREE.Mesh(fuseGeom, solidMat);
            const fuseWire = new THREE.LineSegments(new THREE.WireframeGeometry(fuseGeom), wireMat);
            fuseMesh.rotation.z = -Math.PI/2;
            fuseWire.rotation.z = -Math.PI/2;
            aircraftGroup.add(fuseMesh);
            aircraftGroup.add(fuseWire);

            // --- WINGS (Swept Back to -X) ---
            const wingShape = new THREE.Shape();
            wingShape.moveTo(1.5, 0); 
            wingShape.lineTo(-1.5, 0);
            wingShape.lineTo(-3.5, -4.5);
            wingShape.lineTo(-2.5, -4.5); 
            wingShape.lineTo(1.5, 0);
            
            const wingGeom = new THREE.ExtrudeGeometry(wingShape, { depth: 0.1, bevelEnabled: false });
            const lWing = new THREE.LineSegments(new THREE.WireframeGeometry(wingGeom), wireMat);
            lWing.rotation.x = Math.PI/2;
            lWing.position.set(0, -0.2, 0);
            aircraftGroup.add(lWing);

            const rWing = new THREE.LineSegments(new THREE.WireframeGeometry(wingGeom), wireMat);
            rWing.rotation.x = Math.PI/2;
            rWing.scale.y = -1; 
            rWing.position.set(0, -0.2, 0);
            aircraftGroup.add(rWing);

            // --- TAIL ---
            const vShape = new THREE.Shape();
            vShape.moveTo(0,0); vShape.lineTo(2,0); vShape.lineTo(1, 2.5); vShape.lineTo(0, 2.5);
            const vGeom = new THREE.ExtrudeGeometry(vShape, {depth: 0.1, bevelEnabled: false});
            const vTail = new THREE.LineSegments(new THREE.WireframeGeometry(vGeom), wireMat);
            vTail.position.set(-5, 0.5, 0);
            aircraftGroup.add(vTail);

            const hShape = new THREE.Shape();
            hShape.moveTo(0,0); hShape.lineTo(-1.5, 0); hShape.lineTo(-2, -1.5); hShape.lineTo(-1, -1.5);
            const hGeom = new THREE.ExtrudeGeometry(hShape, {depth: 0.05, bevelEnabled: false});
            const hTailL = new THREE.LineSegments(new THREE.WireframeGeometry(hGeom), wireMat);
            hTailL.rotation.x = Math.PI/2;
            hTailL.position.set(-4.5, 0.3, 0);
            aircraftGroup.add(hTailL);
            const hTailR = hTailL.clone();
            hTailR.scale.y = -1;
            aircraftGroup.add(hTailR);

            // --- ENGINES ---
            const engGeom = new THREE.CylinderGeometry(0.35, 0.3, 1.2, 12, 1, true);
            const engWire = new THREE.LineSegments(new THREE.WireframeGeometry(engGeom), wireMat);
            engWire.rotation.z = Math.PI/2;

            const addEng = (x, z) => {
                const e = engWire.clone();
                e.position.set(x, -0.5, z);
                aircraftGroup.add(e);
            };

            const scale = AC_DATA[acId].scale;
            aircraftGroup.scale.set(scale, scale, scale);

            if(AC_DATA[acId].eng === 2) {
                addEng(0, 2); addEng(0, -2);
            } else {
                addEng(0.5, 1.5); addEng(-0.5, 3.5);
                addEng(0.5, -1.5); addEng(-0.5, -3.5);
            }

            const grid = new THREE.GridHelper(30, 30, 0x222222, 0x111111);
            grid.position.y = -2;
            scene.add(grid);

            function animate() {
                requestAnimationFrame(animate);
                if(controls) controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        window.onload = init;
    </script>
</body>
</html>